<h1>Products</h1>

<% if authenticated? %>
  <p>
    Logged in as <%= Current.user.email_address %>
    <% if Current.user.admin? %><strong>(Admin)</strong><% end %>
    | <%= link_to "Logout", session_path, data: { turbo_method: :delete } %>
  </p>
<% else %>
  <p><%= link_to "Login", new_session_path %></p>
<% end %>

<hr>

<div id="products">
  <% @products.each do |product| %>
    <div style="padding: 10px; margin: 5px 0; border: 1px solid #ccc;">
      <strong><%= link_to product.name, product_path(product) %></strong>
      <% unless product.published? %>
        <span style="color: orange;">(Draft)</span>
      <% end %>

      <div style="margin-top: 5px;">
        <% if allowed_to?(:edit?, product) %>
          <%= link_to "Edit", edit_product_path(product) %>
        <% end %>

        <% if allowed_to?(:destroy?, product) %>
          <%= button_to "Delete", product_path(product), method: :delete,
            data: { turbo_confirm: "Are you sure?" } %>
        <% end %>
      </div>
    </div>
  <% end %>
</div>

<% if allowed_to?(:create?, Product.new) %>
  <p><%= link_to "New Product", new_product_path %></p>
<% end %>
